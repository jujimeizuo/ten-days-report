# 2024 年 3 月 10 日

## 三维点云处理

### 深度学习在点云上的运用

三种方法：

- VoxNet：计算量巨大
- 投影二维卷积法
- PointNet
    - 核心思想那个：share MLP + MaxPool
    - PointNet++：分为 Encoder、Segmentation、Classification 三部分


### 3D 目标检测

- 目标检测任务：定位 + 分类
- 检测的指标：正确率和召回率
- 优化的 trick：NMS
- 2D 目标检测的两种方式：
    - Two Stage：
        - RCNN：ROI（定位）+ CNN（分类）
        - Fast RCNN：由于传统的 RCNN 的 ROI 提取后进行的 CNN 次数过多，所以 Fast RCNN 提出先对图片进行一次 CNN，再在 feature map 上进行处理
        - Mask RCNN：对 ROI Pooling 的改进：ROI Aligin
        - Faster RCNN：
            - RPN 解决定位的问题，核心思想是使用 anchors box 进行神经网络的暴力穷举，得到最佳的 Region Proposal，得到的 classification 结果为 2k YES（anchors 包含物体），N O（anchors 不包含物体），regression 结果为 4k，在 YES 的前提下，Region Proposal 最合适的 [x, y, h, w]
    - One Stage：
        - 没有 ROI Pooling，最具代表性的有 SSD、YOLO 等
- 3D 目标检测：
    - MV3D：多视图的方法
    - VoxelNet：其中核心思想是 VFE，将体素特征进行编码，得到体素的特征向量
    - PointRCNN

### 特征提取

- Harris 特征点：
    - 3D 中的难点：
        - 点云是离散的
        - 在点云里的一个 patch 如何定义
        - 如何移动一个 patch
    - 通过协方差矩阵求解
    - Harris 3D 带反射率：协方差矩阵为反射率的梯度
    - Harris 3D 不带反射率：协方差矩阵为表面法向量
    - Harris 6D：协方差矩阵为反射率的梯度 + 表面法向量
- ISS 特征点：
    1. 对点云的每一个 pi 建立一个局部坐标系，并对所有点设立一个搜索半径 r
    2. 对任意点 pj，求出权重，表示邻居 r 内点的个数
    3. 计算协方差矩阵
    4. 计算出特征值从大到小排序，并添加约束：lamda1 > lamda2 > lamda3
    5. 用 NMS 对多个 lamda3 进行处理
    - 在标准场景下传统方法效果很好，加入高斯噪声后，传统方法效果不好
- USIP 特征点：
    - 深度学习出来的特征点
    - 一个点是特征点，无论从哪个角度去观察这个物体或场景，它都是一个特征点

### 特征描述子

- PFH 描述子：
    - 根据 pair 建立坐标系，计算特征，把特征放入直方图，最终输出一个 B^3 的特征向量
- FPFH：
    - 计算自身和 r 领域内的三元组 (alpha、phi、theta)，距离 d 不用计算
    - 是 PFH 的优化，SPFH并不是全连接，每次只需要计算自身的特征点的描述子和其邻居的描述子，大大减少的计算量
    - 最终输出一个 3B 的特征向量


### 点云配准

- 是一种传统方法，通过最小化损失函数求解 Point-to-Point
- 基于 Point-to-Point 的方法，会由于平面之间的滑动导致匹配错误的问题，所以通过 Point-to-Plane 进行优化，求源点云 pi 到目标点云 qi 组成的曲面的距离（需要提供每个点的法向量）
- 在实际的 ICP 应用中，由于初始位姿不确定，需要采用 特征提取+描述子+RANSAC 进行初始估计，最后采用 ICP 进行精确的位姿估计
- 算法流程：
    - 首先使用 ISS 检测关键点
    - 对原始点云进行下采样/滤波并进保留关键点
    - 计算关键点周围的 FPFH 描述子
    - 在下采样的点云上使用 RANSAC 进行初始姿态估计
    - 使用关键点云进行初始细化
    - 使用原始点云进行最终细化
    - 给予特征映射可视化配准和关键点关联

## 视觉 SLAM

之前学习了 SLAM 的前端部分，还剩下后端的部分给补上，后面还需要重新过一遍，卡尔曼滤波这些需要巩固。

### 光流法和直接法

- 之前视觉里程计通过特征点法计算相机位姿，估计相机运动并送入后端，而光流法和直接法不使用特征匹配计算 VO
- 光流法：追踪源图像某个点在其他图像中的运动（保留特征点，只计算关键点，不计算描述子）
- 光流仅估计了像素间的平移，很多信息没有考虑到，直接法是光流法的优化
- 直接法：像素灰度引导优化的方向，必须保证从初始估计到最优估计中间的梯度一直下降（只计算关键点，不计算描述子）
- 这两种方法的前提是：灰度不变假设


### 后端优化

- 滤波器后端：KF、EKF、MSCKF
- BA 与图优化：根据最小化重投影误差的雅可比矩阵的稀疏性进行图优化
- Pose Graph：省略了特征点的 BA，在优化几次以后把特征点固定住不再优化，只当做位姿估计的约束，之后主要优化位姿。

### 回环检测

- 流程：
    - 检测到回环的发生
    - 计算回环修选帧与当前帧的运动
    - 验证回环是否成立
    - 闭环
- 回环检测：对任意两个关键帧进行特征匹配
    - 基于里程计
    - 基于外观（计算图像之间的相似度）


### 卡尔曼滤波推导

学习自：https://www.bilibili.com/video/BV1ez4y1X7eR/?vd_source=5e048b202705330980eefcc9a56cc5d0


## 下一个 10 天计划

- orb-slam2 的源码解析